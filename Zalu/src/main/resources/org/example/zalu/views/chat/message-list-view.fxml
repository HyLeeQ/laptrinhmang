<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.image.ImageView?>

<?import javafx.geometry.Insets?>
<BorderPane xmlns="http://javafx.com/javafx/21" xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="org.example.zalu.controller.chat.MessageListController"
            styleClass="message-list-root" stylesheets="@/styles.css">

    <!-- Header: Avatar + TÃªn + Tráº¡ng thÃ¡i -->
    <top>
        <HBox fx:id="chatHeader" styleClass="chat-header" visible="false" managed="false">
            <padding><Insets top="12" right="20" bottom="12" left="20"/></padding>
            <children>
                <ImageView fx:id="friendAvatar" fitHeight="44" fitWidth="44" styleClass="avatar-image"/>
                <VBox spacing="4">
                    <Label fx:id="friendNameLabel" text="Zalu" styleClass="friend-name"/>
                    <Label fx:id="friendStatusLabel" text="Chá»n má»™t cuá»™c trÃ² chuyá»‡n" styleClass="friend-status"/>
                </VBox>
                <Region HBox.hgrow="ALWAYS"/>
                <HBox spacing="24">
                    <Button fx:id="searchButton" text="ðŸ”" styleClass="header-icon" onAction="#toggleSearchBar"/>
                    <Button text="ðŸ“ž" styleClass="header-icon"/>
                    <Button text="â‹®" styleClass="header-icon" onAction="#toggleInfoPanel"/>
                </HBox>
            </children>
        </HBox>
    </top>

    <!-- Khu vá»±c tin nháº¯n -->
    <center>
        <VBox>
            <!-- Search bar -->
            <HBox fx:id="searchBar" styleClass="search-bar" visible="false" managed="false" spacing="8">
                <padding><Insets top="8" right="12" bottom="8" left="12"/></padding>
                <TextField fx:id="searchField" promptText="TÃ¬m kiáº¿m trong cuá»™c trÃ² chuyá»‡n..." HBox.hgrow="ALWAYS" onAction="#handleSearch" onKeyReleased="#handleSearchKeyReleased"/>
                <Button fx:id="searchPrevButton" text="â–²" onAction="#handleSearchPrevious" disable="true"/>
                <Button fx:id="searchNextButton" text="â–¼" onAction="#handleSearchNext" disable="true"/>
                <Label fx:id="searchResultLabel" text="0/0"/>
                <Button text="âœ•" onAction="#handleCloseSearch"/>
            </HBox>
            
            <!-- Pinned messages section -->
            <VBox fx:id="pinnedMessagesSection" styleClass="pinned-messages-section" visible="false" managed="false">
                <padding><Insets top="8" right="12" bottom="8" left="12"/></padding>
                <HBox spacing="8" alignment="CENTER_LEFT">
                    <Label text="ðŸ“Œ Tin nháº¯n Ä‘Ã£ ghim" styleClass="pinned-section-title"/>
                    <Region HBox.hgrow="ALWAYS"/>
                    <Button text="áº¨n" onAction="#handleHidePinnedMessages" styleClass="pinned-hide-btn"/>
                </HBox>
                <VBox fx:id="pinnedMessagesContainer" spacing="4"/>
            </VBox>
            
            <ScrollPane fx:id="chatScrollPane" fitToWidth="true" fitToHeight="true" styleClass="messages-scroll" pannable="true">
                <VBox fx:id="chatArea" styleClass="messages-vbox"/>
            </ScrollPane>
        </VBox>
    </center>

    <right>
        <VBox fx:id="infoPanel" styleClass="info-panel" prefWidth="340" visible="false" managed="false">
            <padding><Insets top="16" right="16" bottom="16" left="16"/></padding>
            <Label text="ThÃ´ng tin há»™i thoáº¡i" styleClass="info-title"/>
            <TabPane fx:id="infoTabPane" tabClosingPolicy="UNAVAILABLE" styleClass="info-tabpane">
                <tabs>
                    <Tab fx:id="directTab" text="Nháº¯n 1-1">
                        <ScrollPane fitToWidth="true" hbarPolicy="NEVER" vbarPolicy="AS_NEEDED" styleClass="info-scroll">
                            <VBox spacing="16" styleClass="info-tab-content">
                                <HBox spacing="12" alignment="CENTER_LEFT">
                                    <StackPane styleClass="info-avatar-frame">
                                        <ImageView fx:id="infoAvatar" fitHeight="60" fitWidth="60"/>
                                    </StackPane>
                                    <VBox spacing="4" HBox.hgrow="ALWAYS">
                                        <Label fx:id="infoNameLabel" text="TÃªn báº¡n bÃ¨" styleClass="info-name" wrapText="true"/>
                                        <Label fx:id="infoStatusLabel" text="Tráº¡ng thÃ¡i" styleClass="info-status"/>
                                    </VBox>
                                </HBox>
                            <VBox spacing="8" styleClass="info-pill-row">
                                <HBox spacing="8">
                                    <Button text="ðŸ‘¤ Xem há»“ sÆ¡" onAction="#handleViewBio" styleClass="info-action-btn" HBox.hgrow="ALWAYS" maxWidth="Infinity" wrapText="true"/>
                                    <Button text="ðŸ”” Táº¯t thÃ´ng bÃ¡o" onAction="#handleMuteConversation" styleClass="info-action-btn" HBox.hgrow="ALWAYS" maxWidth="Infinity" wrapText="true"/>
                                </HBox>
                                <HBox spacing="8">
                                    <Button text="ðŸ“Œ Ghim" onAction="#handlePinConversation" styleClass="info-action-btn" HBox.hgrow="ALWAYS" maxWidth="Infinity" wrapText="true"/>
                                    <Button text="âž• NhÃ³m" onAction="#handleCreateGroupFromFriend" styleClass="info-action-btn" HBox.hgrow="ALWAYS" maxWidth="Infinity" wrapText="true"/>
                                </HBox>
                            </VBox>

                            <VBox spacing="8">
                                <Label text="áº¢nh / Video gáº§n Ä‘Ã¢y" styleClass="section-title"/>
                                <FlowPane fx:id="mediaPreviewPane" hgap="8" vgap="8" prefWrapLength="260" styleClass="media-preview-pane"/>
                                <Button text="Xem táº¥t cáº£" onAction="#handleViewAllMedia" styleClass="info-light-btn"/>
                            </VBox>

                            <VBox spacing="8">
                                <Label text="File" styleClass="section-title"/>
                                <ListView fx:id="directFileListView" prefHeight="120"/>
                                <Button text="Xem táº¥t cáº£ file" onAction="#handleViewAllFiles" styleClass="info-light-btn"/>
                            </VBox>

                            <VBox spacing="8">
                                <Label text="Link" styleClass="section-title"/>
                                <ListView fx:id="directLinkListView" prefHeight="100"/>
                                <Button text="Xem táº¥t cáº£ link" onAction="#handleViewAllLinks" styleClass="info-light-btn"/>
                            </VBox>

                            <VBox spacing="12" styleClass="section-card">
                                <Label text="Thiáº¿t láº­p báº£o máº­t" styleClass="section-title"/>
                                <Label text="Tin nháº¯n tá»± xÃ³a: KhÃ´ng bao giá»" styleClass="info-note"/>
                                <HBox spacing="8" alignment="CENTER_LEFT">
                                    <CheckBox fx:id="hideConversationCheck" onAction="#handleToggleHideConversation"/>
                                    <Label text="áº¨n trÃ² chuyá»‡n"/>
                                </HBox>
                            </VBox>

                            <VBox spacing="8">
                                <Button text="âš ï¸ BÃ¡o xáº¥u" onAction="#handleReportConversation" styleClass="danger-outline-btn"/>
                                <Button text="ðŸ—‘ XÃ³a lá»‹ch sá»­ trÃ² chuyá»‡n" onAction="#handleClearHistory" styleClass="danger-btn"/>
                            </VBox>
                            </VBox>
                        </ScrollPane>
                    </Tab>
                    <Tab fx:id="groupTab" text="Nháº¯n nhÃ³m">
                        <ScrollPane fitToWidth="true" hbarPolicy="NEVER" vbarPolicy="AS_NEEDED" styleClass="info-scroll">
                            <VBox spacing="16" styleClass="info-tab-content">
                                <HBox spacing="12" alignment="CENTER_LEFT">
                                    <StackPane styleClass="info-avatar-frame group-placeholder"/>
                                    <VBox spacing="4" HBox.hgrow="ALWAYS">
                                        <Label fx:id="groupNameInfoLabel" text="TÃªn nhÃ³m" styleClass="info-name" wrapText="true"/>
                                        <Label fx:id="groupMemberCountLabel" text="0 thÃ nh viÃªn" styleClass="info-status"/>
                                    </VBox>
                                </HBox>
                            <VBox spacing="8" styleClass="info-pill-row">
                                <HBox spacing="8">
                                    <Button text="ðŸ”” Táº¯t thÃ´ng bÃ¡o" onAction="#handleMuteConversation" styleClass="info-action-btn" HBox.hgrow="ALWAYS" maxWidth="Infinity" wrapText="true"/>
                                    <Button text="ðŸ“Œ Ghim" onAction="#handlePinConversation" styleClass="info-action-btn" HBox.hgrow="ALWAYS" maxWidth="Infinity" wrapText="true"/>
                                </HBox>
                                <HBox spacing="8">
                                    <Button text="âž• ThÃªm thÃ nh viÃªn" onAction="#handleAddMember" styleClass="info-action-btn" HBox.hgrow="ALWAYS" maxWidth="Infinity" wrapText="true"/>
                                </HBox>
                            </VBox>

                            <VBox spacing="8">
                                <Label text="ThÃ nh viÃªn nhÃ³m" styleClass="section-title"/>
                                <ListView fx:id="groupMembersList" prefHeight="180"/>
                                <Button text="Quáº£n lÃ½ nhÃ³m" onAction="#handleManageGroup" styleClass="info-light-btn"/>
                            </VBox>

                            <VBox spacing="8">
                                <Label text="File" styleClass="section-title"/>
                                <ListView fx:id="groupFileListView" prefHeight="120"/>
                                <Button text="Xem táº¥t cáº£ file" onAction="#handleViewAllGroupFiles" styleClass="info-light-btn"/>
                            </VBox>

                            <VBox spacing="8">
                                <Label text="Link" styleClass="section-title"/>
                                <ListView fx:id="groupLinkListView" prefHeight="100"/>
                                <Button text="Xem táº¥t cáº£ link" onAction="#handleViewAllGroupLinks" styleClass="info-light-btn"/>
                            </VBox>

                            <VBox spacing="12" styleClass="section-card">
                                <Label text="Thiáº¿t láº­p báº£o máº­t" styleClass="section-title"/>
                                <Label text="Tin nháº¯n tá»± xÃ³a: Chá»‰ dÃ nh cho quáº£n trá»‹" styleClass="info-note"/>
                                <HBox spacing="8" alignment="CENTER_LEFT">
                                    <CheckBox fx:id="groupHideConversationCheck" onAction="#handleToggleGroupHideConversation"/>
                                    <Label text="áº¨n trÃ² chuyá»‡n"/>
                                </HBox>
                            </VBox>

                            <VBox spacing="8">
                                <Button text="âš ï¸ BÃ¡o xáº¥u" onAction="#handleGroupReport" styleClass="danger-outline-btn"/>
                                <Button text="ðŸ—‘ XÃ³a lá»‹ch sá»­ trÃ² chuyá»‡n" onAction="#handleGroupClearHistory" styleClass="danger-btn"/>
                                <Button text="ðŸšª Rá»i nhÃ³m" onAction="#handleLeaveGroup" styleClass="danger-btn"/>
                            </VBox>
                            </VBox>
                        </ScrollPane>
                    </Tab>
                </tabs>
            </TabPane>
        </VBox>
    </right>

</BorderPane>